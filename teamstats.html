<!DOCTYPE html>
<html>
  <head>
   <meta charset="UTF-8">
   <title>Test</title>
  </head>
  <body>
    <p id="p0"></p>
    <p id="p1"></p>
    <p id="p2"></p>
    <p id="p3"></p>
    <p id="p4"></p>
    <script>
      
      //Consider doing team win-rate, or something of the sort.
      //Think of stats that populate as a team.
      
      var nameSpace = {};
      var players = new Array();
      
      //Insert your key here.
      var key = "5078e4f1-8729-4653-87c0-a0356049f292";
      var championlookup = "https://global.api.pvp.net/api/lol/static-data/na/v1.2/champion/<champid>?api_key=" + key; 
      
      var playersu = {
        "tsm": {
          "dyrus":{url:("https://na.api.pvp.net/api/lol/na/v1.3/stats/by-summoner/5908/ranked?season=SEASON2015&api_key=" + key), id:5908, position:0},
          "santorin":{url:("https://na.api.pvp.net/api/lol/na/v1.3/stats/by-summoner/57029179/ranked?season=SEASON2015&api_key=" + key), id:57029179, position:1},  
          "bjergsen":{url:("https://na.api.pvp.net/api/lol/na/v1.3/stats/by-summoner/50759139/ranked?season=SEASON2015&api_key=" + key), id:50759139, position:2},
          "lustboy":{url:("https://na.api.pvp.net/api/lol/na/v1.3/stats/by-summoner/56917699/ranked?season=SEASON2015&api_key=" + key), id:56917699, position:3},
          "wildturtle":{url:("https://na.api.pvp.net/api/lol/na/v1.3/stats/by-summoner/18991200/ranked?season=SEASON2015&api_key=" + key), id:18991200, position:4}}};

      function loadJSONAsync(player, callback) {
        var xmlHttp = new XMLHttpRequest();
        if(xmlHttp){
        xmlHttp.onreadystatechange = function(){
            if(xmlHttp.readyState == 1) {
                console.log("Status 1: Server connection established! <br/>");
            }
            else if (xmlHttp.readyState == 2) {
               console.log("Status 2: Request recieved! <br/>");
            }
            else if (xmlHttp.readyState == 3) {
               console.log("Status 3: Processing Request!<br/>");
            }
            else if (xmlHttp.readyState == 4) {
        
                if (xmlHttp.status == 200) {
                  var text = xmlHttp.responseText;
                  var obj = JSON.parse(text);
                  callback(obj);
                }
                else {
                    alert("Something is wrong!");
                }
            }
            };
        
        xmlHttp.open("GET", player, true);
        xmlHttp.send();
        }
      }
      
    function mostPlayed(stats) {
      var champs = {};
      for (var i in stats["champions"]) {
        var champid = stats["champions"][i]["id"];
        var most = stats["champions"][i]["stats"].totalSessionsPlayed;
        champs[champid] = most;
      }
      
      var idd = stats["summonerId"];
      console.log(idd);
      var pospospos;
      
      for (var team in playersu) {
        for (var p in playersu[team]) {
          if ((playersu[team][p]["id"]) == idd) {
            pospospos = (playersu[team][p]["position"])
          }
        }
      }
      console.log(pospospos);  
      console.log(champs);
      
      var highest = 0;   
      for (var z in champs) {
        if (champs.hasOwnProperty(z)) {
          if (champs[z] > highest && z != 0) {
            var highest = champs[z];
            var highestid = z;
          }
        }
      }
      
      console.log(highestid);
      console.log(highest);
      console.log(championlookup.replace("<champid>", highestid));
      console.log(JSON.stringify(champs));
      
      var newurl = championlookup.replace("<champid>", highestid);
      
      loadJSONAsync(newurl, function(obj) {
        var playerstats = {champ:obj.key, games:highest, position:pospospos};     
        players.push(playerstats);
        champs = {};   
      });
    }
    
    //Returns true if players array is filled to cap.  
    function arrayFinished(arr, cap) {
      return(arr.length == cap);
    }
    
    //Checks if array is filled to cap every interval. Only then is it processed to avoid processing
    //an empty array. Takes a parameter for the array cap that is passed to arrayFinished().
    function checkIfFinished(cap) {
      var timeout = setInterval(function() {
        if(arrayFinished(players, cap)) {
        
          clearInterval(timeout);
          players.sort(compare);
          
          console.log(players[0].champ);
          console.log(players);
          document.getElementById("p0").innerHTML = players[0].champ;
          document.getElementById("p1").innerHTML = players[1].champ;
          document.getElementById("p2").innerHTML = players[2].champ;
          document.getElementById("p3").innerHTML = players[3].champ;
          document.getElementById("p4").innerHTML = players[4].champ;
        }
      }, 100);
    }

    //Sorts in ascending order by player position down the map, top to adc.
    function compare(a, b) {
      return a.position - b.position;
    }
    
    //...clears player array.
    function clearPlayerArray() {
      players = [];
    }
    
    //This is how you call the JSON function every time:
    function loadTSM() {
      clearPlayerArray();
      
      loadJSONAsync(playersu["tsm"]["dyrus"]["url"], mostPlayed);
      loadJSONAsync(playersu["tsm"]["santorin"]["url"], mostPlayed);
      loadJSONAsync(playersu["tsm"]["bjergsen"]["url"], mostPlayed);
      loadJSONAsync(playersu["tsm"]["wildturtle"]["url"], mostPlayed);
      loadJSONAsync(playersu["tsm"]["lustboy"]["url"], mostPlayed);   
      checkIfFinished(5);      
    }
    
    loadTSM();
    //Callback function is whatever I want to actually use it for.
    //Like getting most-played champ or whatever.
    
    //My idea is to fill an array with member objects 
    //The array will not be processed until it is filled with all members.
      
    </script>
  </body>
</html>